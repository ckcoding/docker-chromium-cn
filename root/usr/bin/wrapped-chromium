#!/bin/bash

set -euo pipefail

BIN=/usr/bin/chromium

# Cleanup
if ! pgrep chromium > /dev/null; then
  rm -f "$HOME"/.config/chromium/Singleton*
fi

# Chinese language flags
LANG_FLAGS="--lang=zh-CN --accept-lang=zh-CN,zh,en-US,en"

# Run normally on privved containers or modified un non priv
if grep -q 'Seccomp:.0' /proc/1/status; then
  exec ${BIN} \
  ${LANG_FLAGS} \
  --no-first-run \
  --password-store=basic \
  --simulate-outdated-no-au='Tue, 31 Dec 2099 23:59:59 GMT' \
  --start-maximized \
  --user-data-dir \
  "$@"
else
  exec ${BIN} \
  ${LANG_FLAGS} \
  --no-first-run \
  --no-sandbox \
  --password-store=basic \
  --simulate-outdated-no-au='Tue, 31 Dec 2099 23:59:59 GMT' \
  --start-maximized \
  --test-type \
  --user-data-dir \
  "$@"
fi
